# üîç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –æ–±–∑–æ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: 2025-12-21

## ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–Ω–æ—Ä–µ–ø–æ –ø–∞–∫–µ—Ç—ã
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ concerns: database, shared, agents, data-import
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ apps/ (api, web)

### 2. –¢–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ TypeScript –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
- ‚úÖ Prisma —Ç–∏–ø—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ Zod –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- ‚úÖ Dependency Injection —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç—ã
- ‚úÖ Service layer pattern (DataImportService)
- ‚úÖ Repository pattern —á–µ—Ä–µ–∑ Prisma
- ‚úÖ Middleware pattern –¥–ª—è auth

---

## ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∫–æ—Å—Ç—ã–ª–∏)

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `any` —Ç–∏–ø–æ–≤

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞**:

#### `apps/api/src/routes/import.routes.ts`
```typescript
let DataImportService: any = null;  // ‚ùå –ö–æ—Å—Ç—ã–ª—å
const activeImports = new Map<string, any>();  // ‚ùå –ö–æ—Å—Ç—ã–ª—å
```

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å conditional types
```typescript
type DataImportServiceType = typeof import('@soul-kg-crm/data-import').DataImportService;
let DataImportService: DataImportServiceType | null = null;
```

#### `apps/web/lib/api-client.ts`
```typescript
const originalRequest = error.config as any;  // ‚ùå –ö–æ—Å—Ç—ã–ª—å
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø Axios
```typescript
const originalRequest = error.config as InternalAxiosRequestConfig & { _retry?: boolean };
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `require()` –≤–º–µ—Å—Ç–æ `import`

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞**:

#### `apps/api/src/index.ts`
```typescript
importRoutes = require('./routes/import.routes');  // ‚ùå –ö–æ—Å—Ç—ã–ª—å
authRoutes = require('./routes/auth.routes').default;  // ‚ùå –ö–æ—Å—Ç—ã–ª—å
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π import –∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ES imports
```typescript
// –í–∞—Ä–∏–∞–Ω—Ç 1: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π import
const importRoutes = await import('./routes/import.routes');

// –í–∞—Ä–∏–∞–Ω—Ç 2: –û–±—ã—á–Ω—ã–π import —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
import importRoutes from './routes/import.routes';
```

**–ü—Ä–∏—á–∏–Ω–∞ –∫–æ—Å—Ç—ã–ª—è**: –ü–æ–ø—ã—Ç–∫–∞ —Å–¥–µ–ª–∞—Ç—å routes –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏.  
**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –í—Å–µ routes –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏, –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dependency injection.

### 3. –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏

#### `apps/api/src/routes/import.routes.ts`
```typescript
const activeImports = new Map<string, any>();  // ‚ùå –ö–æ—Å—Ç—ã–ª—å
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –∏–ª–∏ –ë–î –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤.

### 4. –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `console.log`

**–ü—Ä–æ–±–ª–µ–º–∞**: `console.log/warn/error` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ –≤–º–µ—Å—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å logger utility:
```typescript
// packages/shared/src/utils/logger.ts
export const logger = {
  info: (message: string, meta?: object) => console.log(JSON.stringify({ level: 'info', message, ...meta })),
  warn: (message: string, meta?: object) => console.warn(JSON.stringify({ level: 'warn', message, ...meta })),
  error: (message: string, error?: Error, meta?: object) => console.error(JSON.stringify({ level: 'error', message, error: error?.message, stack: error?.stack, ...meta })),
};
```

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω–æ

1. **–ó–∞–º–µ–Ω–∏—Ç—å `any` —Ç–∏–ø—ã** –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ TypeScript —Ç–∏–ø—ã
2. **–ó–∞–º–µ–Ω–∏—Ç—å `require()`** –Ω–∞ `import` –∏–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π import
3. **–°–æ–∑–¥–∞—Ç—å logger utility** –≤–º–µ—Å—Ç–æ console.log

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω–æ

4. **–ó–∞–º–µ–Ω–∏—Ç—å in-memory storage** –Ω–∞ Redis/–ë–î –¥–ª—è activeImports
5. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π error handler
6. **–î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã –¥–ª—è error handling** –≤–º–µ—Å—Ç–æ `error: any`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ

7. **–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (Winston, Pino)
8. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Sentry –¥–ª—è –æ—à–∏–±–æ–∫)
9. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏** (Prometheus –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ)

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

### –¢–∏–ø–∏–∑–∞—Ü–∏—è
- [ ] –ù–µ—Ç `any` —Ç–∏–ø–æ–≤ (–∫—Ä–æ–º–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)
- [ ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ù–µ—Ç `@ts-ignore` –∏–ª–∏ `@ts-nocheck`

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ concerns —Å–æ–±–ª—é–¥–µ–Ω–æ
- [ ] –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è –æ—à–∏–±–æ–∫
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è logger –≤–º–µ—Å—Ç–æ console.log
- [ ] –õ–æ–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã (JSON)
- [ ] –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

---

## üéØ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–°–æ–∑–¥–∞—Ç—å logger utility** –≤ `packages/shared`
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã** –≤ `import.routes.ts` –∏ `api-client.ts`
3. **–ó–∞–º–µ–Ω–∏—Ç—å require()** –Ω–∞ import –≤ `index.ts`
4. **–î–æ–±–∞–≤–∏—Ç—å Redis/–ë–î** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤
5. **–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π error handler**

---

**–°—Ç–∞—Ç—É—Å**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤ —Ü–µ–ª–æ–º —Ö–æ—Ä–æ—à–∞—è, –Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—Å—Ç—ã–ª–µ–π –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

