# –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞ Development Agent

> **‚ö†Ô∏è –í–ê–ñ–ù–û**: –≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

## üéØ –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞

**–ù–∞–∑–≤–∞–Ω–∏–µ**: –≠—Ç–∞–ø 2 - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WhatsApp Web (MVP)  
**–¢–∏–ø**: Feature  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Critical  
**–≠—Ç–∞–ø**: –≠—Ç–∞–ø 2 - MVP - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WhatsApp Web  
**–ù–∞—á–∞–ª–æ**: 2025-12-23  
**–û–∂–∏–¥–∞–µ–º–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: 2025-12-29 (6 –¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã)

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é WhatsApp Web –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ WhatsApp. –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ –≤ MVP, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç —Å–∏—Å—Ç–µ–º–µ –ø–æ–ª—É—á–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–ü—Ä–æ–±–ª–µ–º–∞**: –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–æ–¥—É–ª—å `packages/data-import` –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ WhatsApp, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥—É–ª—å –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ù—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `packages/whatsapp` –¥–ª—è long-running –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä—ã, –∏–º–ø–æ—Ä—Ç–µ—Ä—ã –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∏–∑ `data-import`, –Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å `whatsapp` –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º WhatsApp –∫–ª–∏–µ–Ω—Ç–æ–º, –æ—á–µ—Ä–µ–¥—å—é —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ —Å–æ–±—ã—Ç–∏–π.

## üîç –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è data-import

### –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ `packages/data-import`

#### ‚úÖ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (100%)

1. **–ü–∞—Ä—Å–µ—Ä—ã** (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö):
   - `language-detector` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
   - `status-detector` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
   - `name-extractor` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞/—Å–æ–æ–±—â–µ–Ω–∏–π
   - `cultural-context-detector` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - `message-parser` - –ø–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

2. **–ò–º–ø–æ—Ä—Ç–µ—Ä—ã** (–ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î):
   - `client-importer` - —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
   - `conversation-importer` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
   - ‚ö†Ô∏è `message-importer` - –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–∞—Ç—á–∞–º–∏, –Ω–∞–º –Ω—É–∂–µ–Ω single message)

3. **–í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã**:
   - `data-validator` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞
   - `duplicate-detector` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

#### ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **WhatsApp –∫–ª–∏–µ–Ω—Ç** (`WhatsAppExtractor`):
   - ‚úÖ –ú–æ–∂–Ω–æ –≤–∑—è—Ç—å –ª–æ–≥–∏–∫—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
   - ‚ùå –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –¥–ª—è long-running —Ä–µ–∂–∏–º–∞ (—Å–µ–π—á–∞—Å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç)
   - ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏

#### ‚ùå –°–æ–∑–¥–∞—Ç—å –∑–∞–Ω–æ–≤–æ

1. **WhatsApp Client –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
   - Long-running —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—á–µ—Ä–µ–¥—å—é –æ—Ç–ø—Ä–∞–≤–∫–∏

2. **Message Queue (BullMQ)**:
   - –û—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - Rate limiting
   - Retry –ª–æ–≥–∏–∫–∞

3. **Message Handler**:
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–µ –±–∞—Ç—á–∞)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI-–∞–≥–µ–Ω—Ç–∞–º–∏ (–ø–æ–∑–∂–µ)
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

4. **Session Manager**:
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏ (–ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ QR-–∫–æ–¥–æ–≤ –≤ –ë–î
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

| –ê—Å–ø–µ–∫—Ç | Data Import (—Ç–µ–∫—É—â–∏–π) | WhatsApp Integration (–Ω–æ–≤—ã–π) |
|--------|----------------------|-------------------------------|
| **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã** | –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (long-running) |
| **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª** | –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è ‚Üí –∏–∑–≤–ª–µ–∫ ‚Üí –æ—Ç–∫–ª—é—á–∏–ª—Å—è | –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è ‚Üí —Å–ª—É—à–∞–µ—Ç ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** | –ü–∞–∫–µ—Ç–Ω–∞—è (–≤—Å–µ —Å—Ä–∞–∑—É) | –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–ø–æ –æ–¥–Ω–æ–º—É) |
| **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** | –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è | –ß–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å (BullMQ) |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏** | –û–¥–Ω–∞ —Å–µ—Å—Å–∏—è –Ω–∞ –∏–º–ø–æ—Ä—Ç | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (–ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º) |
| **–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å exponential backoff |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

```
packages/
‚îú‚îÄ‚îÄ whatsapp/                    # –ù–û–í–´–ô –º–æ–¥—É–ª—å (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp-client.ts   # Long-running –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session-manager.ts   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ queue/                   # –û—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ (BullMQ)
‚îÇ   ‚îî‚îÄ‚îÄ handlers/                # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ
‚îî‚îÄ‚îÄ data-import/                 # –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –º–æ–¥—É–ª—å (–∏–º–ø–æ—Ä—Ç)
    ‚îú‚îÄ‚îÄ extractors/              # –û—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
    ‚îú‚îÄ‚îÄ parsers/                 # ‚úÖ –ü–ï–†–ï–ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨
    ‚îú‚îÄ‚îÄ importers/               # ‚úÖ –ü–ï–†–ï–ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ (—á–∞—Å—Ç–∏—á–Ω–æ)
    ‚îî‚îÄ‚îÄ validators/              # ‚úÖ –ü–ï–†–ï–ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. ‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: –ü–∞—Ä—Å–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
2. ‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: `data-import` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞, `whatsapp` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ**: –ú–æ–∂–Ω–æ —É–ª—É—á—à–∞—Ç—å –∏–º–ø–æ—Ä—Ç –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
4. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–∞—Ä—Å–µ—Ä—ã —É–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

#### –†–∏—Å–∫ 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ WhatsApp –∫–ª–∏–µ–Ω—Ç–∞
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ shared —É—Ç–∏–ª–∏—Ç—ã (`packages/shared/src/whatsapp/utils.ts`)

#### –†–∏—Å–∫ 2: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å–µ—Å—Å–∏–π –º–µ–∂–¥—É –∏–º–ø–æ—Ä—Ç–æ–º –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ `clientId` –∏ `dataPath`:
  - –ò–º–ø–æ—Ä—Ç: `import-${organizationId}`
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: `org-${organizationId}`

#### –†–∏—Å–∫ 3: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@soul-kg-crm/data-import` –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ `whatsapp`

## üéØ –¶–µ–ª–∏

1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `packages/whatsapp` –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ WhatsApp Web
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WhatsApp Client –¥–ª—è long-running —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Session Manager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Message Queue (BullMQ) –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Message Handler —Å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä—Å–µ—Ä–æ–≤ –∏–∑ `data-import`
6. –°–æ–∑–¥–∞—Ç—å API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WhatsApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
7. –°–æ–∑–¥–∞—Ç—å Frontend UI –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WhatsApp
8. –û–±–µ—Å–ø–µ—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –≠—Ç–∞–ø 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ —Å—Ö–µ–º—ã (–î–µ–Ω—å 1, –Ω–∞—á–∞–ª–æ)
**–¶–µ–ª—å**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ WhatsApp –∏ —Å–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã

#### –®–∞–≥ 0.0: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π WhatsApp –≤ –ë–î –¥–ª—è Production ‚úÖ
**–í—Ä–µ–º—è**: 2-3 —á–∞—Å–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Critical (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ prod)
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- LocalAuth —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–µ—Å—Å–∏–∏ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ (`.whatsapp-sessions/`)
- –ù–∞ prod (Railway/Render) —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —ç—Ñ–µ–º–µ—Ä–Ω–∞—è - –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–µ—Å—Å–∏–∏ —Ç–µ—Ä—è—é—Ç—Å—è
- –ù—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ - –ø–ª–æ—Ö–æ–π UX

**–†–µ—à–µ–Ω–∏–µ**: 
- ‚úÖ –°–æ–∑–¥–∞–Ω `DatabaseAuth` –∫–ª–∞—Å—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ `RemoteAuth` —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º `Store`
- ‚úÖ Store —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç ZIP –∞—Ä—Ö–∏–≤—ã —Å–µ—Å—Å–∏–π –≤ –ë–î (`WhatsAppSession.sessionData` –∫–∞–∫ base64)
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é –∏–∑ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Dockerfile –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Chromium –Ω–∞ prod
- ‚úÖ `createWhatsAppClient` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DatabaseAuth` –≤ production
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
  - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: —Ä–∞–∑ –≤ —á–∞—Å (`backupSyncIntervalMs: 3600000`) - —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç –∫—Ä–∞—à–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
  - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ (`disconnected`) - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - –ü—Ä–∏ graceful shutdown - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏: —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–µ—Å—Å–∏—è, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —á–µ—Ä–µ–∑ `DatabaseStore.save()`
2. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ: —Å–µ—Å—Å–∏—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î —á–µ—Ä–µ–∑ `DatabaseStore.extract()`
3. –í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (long-running –∫–ª–∏–µ–Ω—Ç):
   - –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, —Å–µ—Å—Å–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ WebSocket
   - RemoteAuth –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Å—Å–∏—é —Ä–∞–∑ –≤ —á–∞—Å (—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç –∫—Ä–∞—à–∞)
   - –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ (`disconnected`) - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
4. –ü—Ä–∏ graceful shutdown: –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î**:
- –ë—ã–ª–æ: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç = 288 —Ä–∞–∑/–¥–µ–Ω—å √ó 7 –ú–ë = ~2 –ì–ë/–¥–µ–Ω—å –Ω–∞ —Å–µ—Å—Å–∏—é
- –°—Ç–∞–ª–æ: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–∑ –≤ —á–∞—Å + –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ = 24 —Ä–∞–∑–∞/–¥–µ–Ω—å √ó 7 –ú–ë = ~168 –ú–ë/–¥–µ–Ω—å –Ω–∞ —Å–µ—Å—Å–∏—é
- –≠–∫–æ–Ω–æ–º–∏—è: **–≤ 10 —Ä–∞–∑ –º–µ–Ω—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**:
- ‚úÖ `packages/shared/src/whatsapp/database-auth.ts` - DatabaseAuth –∏ DatabaseStore
  - ‚úÖ DatabaseAuth –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `dataPath` –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ RemoteAuth
  - ‚úÖ DatabaseStore –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `dataPath` –¥–ª—è –ø–æ–∏—Å–∫–∞ ZIP —Ñ–∞–π–ª–æ–≤
  - ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω `backupSyncIntervalMs` –¥–æ 1 —á–∞—Å–∞ (–±—ã–ª–æ 5 –º–∏–Ω—É—Ç)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `packages/shared/src/whatsapp/utils.ts` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä auth —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π `dataPath`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `apps/api/Dockerfile` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Chromium –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ `packages/shared/src/whatsapp/index.ts`
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `scripts/save-current-session-to-db.ts` –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Å—Å–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `scripts/test-database-auth.ts` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- ‚úÖ –°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (—Ä–∞–∑–º–µ—Ä: ~5-7 –ú–ë - –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è WhatsApp —Å–µ—Å—Å–∏–∏)
- ‚úÖ –°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î –±–µ–∑ QR –∫–æ–¥–∞
- ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ DatabaseStore –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Store
- ‚úÖ Dockerfile —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Puppeteer
- ‚úÖ –°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ä–∞–∑ –≤ —á–∞—Å (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
- ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (—Å–º. –®–∞–≥ 2.1)
- ‚úÖ Graceful shutdown —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (—Å–º. –®–∞–≥ 2.2)

#### –®–∞–≥ 0.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ WhatsApp
**–í—Ä–µ–º—è**: 30 –º–∏–Ω—É—Ç

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/shared/src/types/whatsapp-settings.ts`:
  - [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `WhatsAppSettings`:
    ```typescript
    interface WhatsAppSettings {
      rateLimiting: {
        messagesPerMinute: number;  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10
        messagesPerHour: number;    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100
        messagesPerDay: number;      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 500
        concurrency: number;         // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3
      };
      safety: {
        enableMassSending: boolean;  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: false
        requireConfirmation: boolean; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: true
        maxBatchSize: number;        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50
      };
    }
    ```
  - [ ] –§—É–Ω–∫—Ü–∏—è `getDefaultWhatsAppSettings(): WhatsAppSettings` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - [ ] –§—É–Ω–∫—Ü–∏—è `validateWhatsAppSettings(settings: Partial<WhatsAppSettings>): WhatsAppSettings` - –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `packages/shared/src/index.ts`

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ (10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É, 3 concurrency)

---

### –≠—Ç–∞–ø 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–î–µ–Ω—å 1)
**–¶–µ–ª—å**: –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É WhatsApp –≤ shared —É—Ç–∏–ª–∏—Ç—ã –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è

#### –®–∞–≥ 1.1: –°–æ–∑–¥–∞–Ω–∏–µ shared —É—Ç–∏–ª–∏—Ç –¥–ª—è WhatsApp
**–í—Ä–µ–º—è**: 1-2 —á–∞—Å–∞

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/shared/src/whatsapp/utils.ts`
- [ ] –í—ã–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `createWhatsAppClientConfig(organizationId: string, mode: 'import' | 'integration')`
  - [ ] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `organizationId`, `mode`
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è `Client` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `clientId` –∏ `dataPath`
  - [ ] –î–ª—è –∏–º–ø–æ—Ä—Ç–∞: `clientId: import-${organizationId}`, `dataPath: .whatsapp-sessions/import-${organizationId}`
  - [ ] –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: `clientId: org-${organizationId}`, `dataPath: .whatsapp-sessions/org-${organizationId}`
- [ ] –í—ã–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `formatPhoneNumber(phone: string): string` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤
- [ ] –í—ã–Ω–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `extractPhoneFromWhatsAppId(whatsappId: string): string` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `packages/shared/src/whatsapp/index.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `packages/shared/src/index.ts` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ WhatsApp —É—Ç–∏–ª–∏—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ (`npm run build` –≤ `packages/shared`)
- [ ] –§—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã (unit —Ç–µ—Å—Ç—ã)
- [ ] –†–∞–∑–Ω—ã–µ `clientId` –∏ `dataPath` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### –®–∞–≥ 1.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ data-import –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è shared —É—Ç–∏–ª–∏—Ç
**–í—Ä–µ–º—è**: 30 –º–∏–Ω—É—Ç

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `packages/data-import/src/extractors/whatsapp-extractor.ts`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `createWhatsAppClientConfig` –∏–∑ shared
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ shared —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–º–ø–æ—Ä—Ç –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–µ—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–∞–ø–∫—É (`.whatsapp-sessions/import-${organizationId}`)
- [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

#### –®–∞–≥ 1.3: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥—É–ª—è whatsapp
**–í—Ä–µ–º—è**: 30 –º–∏–Ω—É—Ç

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/package.json`:
  - [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `whatsapp-web.js`, `bullmq`, `ioredis`, `qrcode`, `@soul-kg-crm/data-import`, `@soul-kg-crm/database`, `@soul-kg-crm/shared`
  - [ ] Scripts: `build`, `dev`, `test`
- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/tsconfig.json` (—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `data-import`)
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫:
  - [ ] `src/client/` - WhatsApp –∫–ª–∏–µ–Ω—Ç –∏ session manager
  - [ ] `src/queue/` - –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π (BullMQ)
  - [ ] `src/handlers/` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  - [ ] `src/api/` - –ü—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
  - [ ] `src/utils/` - –£—Ç–∏–ª–∏—Ç—ã (–ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤)
  - [ ] `src/types/` - TypeScript —Ç–∏–ø—ã
  - [ ] `src/index.ts` - Public API –º–æ–¥—É–ª—è
- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/README.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –º–æ–¥—É–ª—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] `package.json` –∏–º–µ–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

---

### –≠—Ç–∞–ø 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è WhatsApp Client (–î–µ–Ω—å 2)
**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å long-running WhatsApp –∫–ª–∏–µ–Ω—Ç —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–±—ã—Ç–∏–π

#### –®–∞–≥ 2.1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ WhatsApp Client
**–í—Ä–µ–º—è**: 2-3 —á–∞—Å–∞

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/types/whatsapp.types.ts`:
  - [ ] `WhatsAppClientEvents` - —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π (qr, ready, message, disconnected)
  - [ ] `WhatsAppMessage` - —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è
  - [ ] `WhatsAppConnectionStatus` - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/client/whatsapp-client.ts`:
  - [ ] –ö–ª–∞—Å—Å `WhatsAppClient extends EventEmitter`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `client: Client` –∏–∑ `whatsapp-web.js`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `organizationId: string`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `isConnected: boolean`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `reconnectAttempts: number`
  - [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `MAX_RECONNECT_ATTEMPTS = 5`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:
  - [ ] –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `organizationId: string`
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `createWhatsAppClientConfig(organizationId, 'integration')` –∏–∑ shared
  - [ ] –°–æ–∑–¥–∞–µ—Ç `Client` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ `createWhatsAppClient()` –∏–∑ shared
  - [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ `authStrategy` (–¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏):
    - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `private authStrategy?: RemoteAuth`
    - [ ] –ü–æ–ª—É—á–∞–µ—Ç `authStrategy` –∏–∑ `client.options.authStrategy` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
    - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —ç—Ç–æ `RemoteAuth` (–∏–ª–∏ `DatabaseAuth`) —á–µ—Ä–µ–∑ `instanceof RemoteAuth`:
      ```typescript
      import { RemoteAuth } from 'whatsapp-web.js';
      if (this.client.options.authStrategy instanceof RemoteAuth) {
        this.authStrategy = this.client.options.authStrategy;
      }
      ```
    - [ ] –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ `RemoteAuth` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `LocalAuth`) - `authStrategy` –æ—Å—Ç–∞–µ—Ç—Å—è `undefined`, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è dev —Ä–µ–∂–∏–º–∞)
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `setupEventHandlers()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `setupEventHandlers()`:
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `qr` - —ç–º–∏—Ç–∏—Ç —Å–æ–±—ã—Ç–∏–µ `qr` —Å QR-–∫–æ–¥–æ–º
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `ready` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `isConnected = true`, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `reconnectAttempts`, —ç–º–∏—Ç–∏—Ç `ready`
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `authenticated` - –ª–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `auth_failure` - —ç–º–∏—Ç–∏—Ç `auth_failure` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `disconnected`:
    - [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `isConnected = false`
    - [ ] ‚ö†Ô∏è **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏**: –í—ã–∑—ã–≤–∞–µ—Ç `await this.syncSession()` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
    - [ ] –≠–º–∏—Ç–∏—Ç `disconnected` —Å –ø—Ä–∏—á–∏–Ω–æ–π
    - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `handleReconnect()`
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `message` - –≤—ã–∑—ã–≤–∞–µ—Ç `handleIncomingMessage(message)`
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `message_ack` - —ç–º–∏—Ç–∏—Ç `message_ack` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async initialize(): Promise<void>`:
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `this.client.initialize()`
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async sendMessage(to: string, content: string): Promise<Message>`:
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `isConnected`, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
  - [ ] –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ shared —Ñ—É–Ω–∫—Ü–∏—é
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `this.client.sendMessage(number, content)`
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async handleIncomingMessage(message: Message)`:
  - [ ] –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Å–µ–±—è (`message.fromMe`)
  - [ ] –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –∏ –≥—Ä—É–ø–ø–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (`message.isStatus`, `message.from.includes('@g.us')`)
  - [ ] ‚ö†Ô∏è **–ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `message.hasMedia`:
    - [ ] –ï—Å–ª–∏ –µ—Å—Ç—å –º–µ–¥–∏–∞ - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ–¥–∏–∞ –≤ `content` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `[Media: image]` –∏–ª–∏ URL)
    - [ ] ‚ö†Ô∏è **TODO (post-MVP)**: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤ –≤ storage
  - [ ] –≠–º–∏—Ç–∏—Ç —Å–æ–±—ã—Ç–∏–µ `message` —Å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
    - [ ] `id: message.id._serialized`
    - [ ] `from: message.from`
    - [ ] `to: message.to`
    - [ ] `body: message.body`
    - [ ] `timestamp: message.timestamp`
    - [ ] `hasMedia: message.hasMedia`
    - [ ] `type: message.type`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private formatPhoneNumber(phone: string): string`:
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç shared —Ñ—É–Ω–∫—Ü–∏—é `formatPhoneNumber`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private async handleReconnect()`:
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `reconnectAttempts < MAX_RECONNECT_ATTEMPTS`
  - [ ] –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç - —ç–º–∏—Ç–∏—Ç `max_reconnect_reached`
  - [ ] –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `reconnectAttempts`
  - [ ] –í—ã—á–∏—Å–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É —Å exponential backoff: `Math.min(1000 * Math.pow(2, reconnectAttempts), 30000)`
  - [ ] –ß–µ—Ä–µ–∑ `setTimeout` –≤—ã–∑—ã–≤–∞–µ—Ç `this.client.initialize()`
  - [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `handleReconnect()` —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private async syncSession(): Promise<void>`:
  - [ ] ‚ö†Ô∏è **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏**:
    - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `authStrategy` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–µ—Å–ª–∏ `undefined` - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è `LocalAuth` –≤ dev)
    - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `await authStrategy.storeRemoteSession({ emit: true })` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ gracefully (–ª–æ–≥–∏—Ä—É–µ—Ç, –Ω–æ –Ω–µ –ø–∞–¥–∞–µ—Ç):
      ```typescript
      try {
        if (this.authStrategy) {
          await this.authStrategy.storeRemoteSession({ emit: true });
          console.log(`[WhatsApp ${this.organizationId}] Session synced before disconnect`);
        }
      } catch (error) {
        console.error(`[WhatsApp ${this.organizationId}] Failed to sync session:`, error);
        // Don't throw - session sync failure shouldn't prevent disconnect
      }
      ```
    - [ ] –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∏–ª–∏ –≤—ã—Ö–æ–¥–æ–º
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async destroy(): Promise<void>`:
  - [ ] ‚ö†Ô∏è **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ–º**: –í—ã–∑—ã–≤–∞–µ—Ç `await this.syncSession()` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `this.client.destroy()`
  - [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `isConnected = false`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `getConnectionStatus(): boolean`:
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `isConnected`
- [ ] –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–æ –≤—Å–µ–º –º–µ—Ç–æ–¥–∞–º

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] –ö–ª–∞—Å—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `EventEmitter`
- [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (exponential backoff)
- [ ] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç shared —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] ‚ö†Ô∏è **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏**: `syncSession()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ `disconnected` –∏ `destroy()`
- [ ] ‚ö†Ô∏è **AuthStrategy**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ `authStrategy` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `storeRemoteSession()`
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ (initialize, sendMessage, handleReconnect, syncSession)

#### –®–∞–≥ 2.2: –°–æ–∑–¥–∞–Ω–∏–µ Session Manager
**–í—Ä–µ–º—è**: 2-3 —á–∞—Å–∞

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/client/session-manager.ts`:
  - [ ] –ö–ª–∞—Å—Å `WhatsAppSessionManager`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `clients: Map<string, WhatsAppClient>` - –∫—ç—à –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ organizationId
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `incomingQueue?: WhatsAppIncomingQueue` - –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `setIncomingQueue()`)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async getOrCreateClient(organizationId: string): Promise<WhatsAppClient>`:
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ `clients` Map
  - [ ] –ï—Å–ª–∏ –µ—Å—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
  - [ ] –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω - –≤—ã–∑—ã–≤–∞–µ—Ç `initialize()` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç
  - [ ] –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π `WhatsAppClient`, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `setupClientEvents()`, –≤—ã–∑—ã–≤–∞–µ—Ç `initialize()`, –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ Map, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private setupClientEvents(client: WhatsAppClient, organizationId: string)`:
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `qr`:
    - [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç QR-–∫–æ–¥ –≤ –ë–î —á–µ—Ä–µ–∑ `prisma.whatsAppSession.upsert` (‚ö†Ô∏è Prisma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç camelCase: `whatsAppSession`)
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `QR_CODE_PENDING` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum `WhatsAppSessionStatus.QR_CODE_PENDING`)
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `ready`:
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î –Ω–∞ `CONNECTED` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum `WhatsAppSessionStatus.CONNECTED`)
    - [ ] –û—á–∏—â–∞–µ—Ç QR-–∫–æ–¥ (`qrCode: null`)
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç `lastConnectedAt: new Date()`
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `disconnected`:
    - [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `WhatsAppClient.syncSession()` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º —ç—Ç–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î –Ω–∞ `DISCONNECTED` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum `WhatsAppSessionStatus.DISCONNECTED`)
    - [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤ `errorMessage`
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç `lastDisconnectedAt: new Date()`
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `auth_failure`:
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î –Ω–∞ `ERROR` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum `WhatsAppSessionStatus.ERROR`)
    - [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—à–∏–±–∫—É –≤ `errorMessage`
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `message`:
    - [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç `messageHandler.handleIncomingMessage()` –Ω–∞–ø—Ä—è–º—É—é
    - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `incomingQueue` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–µ—Å–ª–∏ –Ω–µ—Ç - –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç)
    - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `incomingQueue.addIncomingMessageJob({ organizationId, message: {...} })`
    - [ ] –≠—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (2-5 —Å–µ–∫)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `setIncomingQueue(incomingQueue: WhatsAppIncomingQueue): void`:
  - [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `incomingQueue` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è (–≤ `packages/whatsapp/src/index.ts` –∏–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async disconnect(organizationId: string): Promise<void>`:
  - [ ] –ü–æ–ª—É—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç –∏–∑ Map
  - [ ] –ï—Å–ª–∏ –µ—Å—Ç—å - –≤—ã–∑—ã–≤–∞–µ—Ç `destroy()` (—ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Å—Å–∏—é), —É–¥–∞–ª—è–µ—Ç –∏–∑ Map
  - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î –Ω–∞ `DISCONNECTED` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum `WhatsAppSessionStatus.DISCONNECTED`)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async disconnectAll(): Promise<void>`:
  - [ ] ‚ö†Ô∏è **Graceful shutdown**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
  - [ ] –ò—Ç–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º –≤ Map
  - [ ] –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `destroy()` (—ç—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Å—Å–∏—é)
  - [ ] –û—á–∏—â–∞–µ—Ç Map –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ graceful shutdown (SIGTERM, SIGINT)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async getStatus(organizationId: string): Promise<WhatsAppSessionStatus | null>`:
  - [ ] –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–∑ –ë–î —á–µ—Ä–µ–∑ `prisma.whatsAppSession.findUnique({ where: { organizationId } })`
  - [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: Prisma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç camelCase –∏–º–µ–Ω–∞ –º–æ–¥–µ–ª–µ–π: `whatsAppSession` (–Ω–µ `WhatsAppSession`)
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `status` –∏–ª–∏ `null` –µ—Å–ª–∏ —Å–µ—Å—Å–∏–∏ –Ω–µ—Ç
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async getQRCode(organizationId: string): Promise<string | null>`:
  - [ ] –ü–æ–ª—É—á–∞–µ—Ç QR-–∫–æ–¥ –∏–∑ –ë–î —á–µ—Ä–µ–∑ `prisma.whatsAppSession.findUnique({ where: { organizationId } })`
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `qrCode` –∏–ª–∏ `null` –µ—Å–ª–∏ –Ω–µ—Ç
- [ ] –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–æ –≤—Å–µ–º –º–µ—Ç–æ–¥–∞–º
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏–∑ `@soul-kg-crm/database` –¥–ª—è `WhatsAppSessionStatus`

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] ‚ö†Ô∏è **Prisma –∏–º–µ–Ω–∞**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –º–æ–¥–µ–ª–µ–π (camelCase: `whatsAppSession`)
- [ ] ‚ö†Ô∏è **Enum –∑–Ω–∞—á–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è enum –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫ (`WhatsAppSessionStatus.CONNECTED`, –Ω–µ `'CONNECTED'`)
- [ ] –°–µ—Å—Å–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- [ ] QR-–∫–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î
- [ ] –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ (–∫–ª–∏–µ–Ω—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ Map –ø—Ä–∏ disconnect)
- [ ] ‚ö†Ô∏è **Graceful shutdown**: `disconnectAll()` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è Session Manager

---

### –≠—Ç–∞–ø 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Message Queue –∏ Handler (–î–µ–Ω—å 3)
**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

#### –®–∞–≥ 3.1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BullMQ –∏ Redis
**–í—Ä–µ–º—è**: 1 —á–∞—Å

- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `bullmq`, `ioredis`
- [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω:
  - [ ] Redis –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ `process.env.REDIS_URL` –∏–ª–∏ `REDIS_HOST`/`REDIS_PORT`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å Redis –≤ `.env.example` –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
  - [ ] –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –∑–∞–ø—É—Å—Ç–∏—Ç—å Redis —á–µ—Ä–µ–∑ Docker –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/queue/message-queue.ts`:
  - [ ] –ö–ª–∞—Å—Å `WhatsAppMessageQueue`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `sendQueue: Queue` (BullMQ)
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `sessionManager: WhatsAppSessionManager`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:
  - [ ] –°–æ–∑–¥–∞–µ—Ç Redis connection:
    - [ ] –ï—Å–ª–∏ `process.env.REDIS_URL` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ
    - [ ] –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `process.env.REDIS_HOST` –∏ `process.env.REDIS_PORT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost:6379`)
    - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
  - [ ] –°–æ–∑–¥–∞–µ—Ç Queue —Å –∏–º–µ–Ω–µ–º `whatsapp-send`
  - [ ] ‚ö†Ô∏è **Rate Limiting –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**:
    - [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `getWhatsAppSettings(organizationId)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ `Organization.settings.whatsapp`
    - [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫:
      ```typescript
      {
        rateLimiting: {
          messagesPerMinute: number;      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10 (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
          messagesPerHour: number;        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100
          messagesPerDay: number;         // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 500
          concurrency: number;            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3 (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
        },
        safety: {
          enableMassSending: boolean;      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: false (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
          requireConfirmation: boolean;    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: true –¥–ª—è >10 —Å–æ–æ–±—â–µ–Ω–∏–π
          maxBatchSize: number;            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50
        }
      }
      ```
    - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ë–î –¥–ª—è rate limiter: `limiter: { max: settings.rateLimiting.messagesPerMinute, duration: 60000 }`
    - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `concurrency: settings.rateLimiting.concurrency` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3, –Ω–µ 5)
    - [ ] –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ—Ç - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - [ ] –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç `defaultJobOptions`:
    - [ ] `attempts: 3` - 3 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    - [ ] `backoff: { type: 'exponential', delay: 2000 }` - exponential backoff
    - [ ] `removeOnComplete: true` - —É–¥–∞–ª—è—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–¥–∞—á–∏
    - [ ] `removeOnFail: false` - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–µ—É–¥–∞—á–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `setupProcessors()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private setupProcessors()`:
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `send-message` job:
    - [ ] –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ: `organizationId`, `to`, `content`, `conversationId`
    - [ ] –ü–æ–ª—É—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ `sessionManager.getOrCreateClient(organizationId)`
    - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `client.sendMessage(to, content)`
    - [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ë–î —á–µ—Ä–µ–∑ `prisma.message.create`:
      - [ ] `conversationId`, `organizationId`
      - [ ] `content`, `direction: MessageDirection.OUTGOING` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum)
      - [ ] `whatsappMessageId: message.id._serialized`
      - [ ] `status: MessageStatus.SENT` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum, –Ω–µ —Å—Ç—Ä–æ–∫–∞)
      - [ ] `sender: MessageSender.AI` –∏–ª–∏ `MessageSender.HUMAN` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum, –Ω–µ —Å—Ç—Ä–æ–∫–∏)
      - [ ] `senderId: null` (–¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç AI) –∏–ª–∏ `senderId: userId` (–¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
      - [ ] `language: null` (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ–∑–∂–µ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ)
      - [ ] `createdAt: new Date()`
    - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success: true, messageId }`
    - [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ - –ª–æ–≥–∏—Ä—É–µ—Ç –∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç (–¥–ª—è retry)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async addSendMessageJob(data: { organizationId, to, content, conversationId, sender?, priority? }): Promise<void>`:
  - [ ] –î–æ–±–∞–≤–ª—è–µ—Ç job –≤ –æ—á–µ—Ä–µ–¥—å —Å —Ç–∏–ø–æ–º `send-message`
  - [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `priority: data.priority || 1` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: 1=normal, 5=high –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤, 10=urgent)
  - [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `sender` (AI/HUMAN) –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - [ ] ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤**: –ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
    - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É/—á–∞—Å/–¥–µ–Ω—å
    - [ ] –ï—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
    - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ (–∫–ª—é—á–∏: `whatsapp:limits:${organizationId}:minute/hour/day`)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async addBulkSendJobs(data: { organizationId, messages: Array<{to, content, conversationId}>, sender?, priority? }): Promise<{success: number, failed: number, errors: Array<{to, error}>}>`:
  - [ ] ‚ö†Ô∏è **–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞**: –î–æ–±–∞–≤–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—å
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `enableMassSending` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
  - [ ] –ï—Å–ª–∏ `requireConfirmation === true` –∏ —Å–æ–æ–±—â–µ–Ω–∏–π > `maxBatchSize` - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É)
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—â–∏–π –ª–∏–º–∏—Ç –Ω–∞ –¥–µ–Ω—å –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
  - [ ] –î–æ–±–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏)
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Å–∫–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ, —Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async close(): Promise<void>`:
  - [ ] –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] ‚ö†Ô∏è **Redis**: Redis –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] BullMQ –æ—á–µ—Ä–µ–¥—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] ‚ö†Ô∏è **Rate Limiting**: Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ –±–æ–ª–µ–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É)
- [ ] Jobs –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Retry –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (exponential backoff)
- [ ] ‚ö†Ô∏è **Enum –∑–Ω–∞—á–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ enum –¥–ª—è MessageStatus, MessageSender, MessageDirection
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è Message Queue

#### –®–∞–≥ 3.1.5: –°–æ–∑–¥–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
**–í—Ä–µ–º—è**: 1.5 —á–∞—Å–∞
**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å rate limiting –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏

**‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–æ—á–µ–º—É –Ω—É–∂–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö?**
- –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ **—Å–æ–±—ã—Ç–∏—è** (–Ω–µ API –∑–∞–ø—Ä–æ—Å—ã), –Ω–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –º—ã –¥–µ–ª–∞–µ–º **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã** (`getContactById`, `getProfilePicUrl`, `getChatById`)
- –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è WhatsApp
- –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã (–º–µ–Ω–µ–µ 2 —Å–µ–∫—É–Ω–¥) –≤—ã–¥–∞—é—Ç –±–æ—Ç–∞
- –ù—É–∂–Ω—ã —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/queue/incoming-queue.ts`:
  - [ ] –ö–ª–∞—Å—Å `WhatsAppIncomingQueue`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `incomingQueue: Queue` (BullMQ)
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `sendQueue: WhatsAppMessageQueue` (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤)
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `sessionManager: WhatsAppSessionManager`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ Redis connection —á—Ç–æ –∏ `WhatsAppMessageQueue`
  - [ ] –°–æ–∑–¥–∞–µ—Ç Queue —Å –∏–º–µ–Ω–µ–º `whatsapp-incoming-process`
  - [ ] ‚ö†Ô∏è **Rate Limiting –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤**:
    - [ ] `limiter: { max: 5, duration: 60000 }` - –º–∞–∫—Å–∏–º—É–º 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
    - [ ] –≠—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Ç–∏–ø–∞ `getContactById`, `getProfilePicUrl`, `getChatById`
  - [ ] `concurrency: 2` - –º–∞–∫—Å–∏–º—É–º 2 —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  - [ ] `defaultJobOptions`:
    - [ ] `attempts: 3` - 3 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    - [ ] `backoff: { type: 'exponential', delay: 2000 }`
    - [ ] `removeOnComplete: true`
    - [ ] `removeOnFail: false`
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `setupProcessors()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private setupProcessors()`:
  - [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `process-incoming` job:
    - [ ] –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ: `organizationId`, `message: {id, from, body, timestamp, conversationId?}`
    - [ ] ‚ö†Ô∏è **–°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π**: `await sleep(randomDelay(2000, 5000))` (2-5 —Å–µ–∫)
    - [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ë–î (–±—ã—Å—Ç—Ä–æ, –±–µ–∑ API):
      - [ ] –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ shared —Ñ—É–Ω–∫—Ü–∏—é `extractPhoneFromWhatsAppId(message.from)`
      - [ ] –ù–∞—Ö–æ–¥–∏—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
      - [ ] –ù–∞—Ö–æ–¥–∏—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä —á–µ—Ä–µ–∑ `importConversation()` –∏–∑ `data-import`
      - [ ] –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ `prisma.message.create` —Å `direction: MessageDirection.INCOMING`, `status: MessageStatus.PENDING`
    - [ ] ‚ö†Ô∏è **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã —Å rate limiting**:
      - [ ] –ü–æ–ª—É—á–∞–µ—Ç WhatsApp –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ `sessionManager.getOrCreateClient(organizationId)`
      - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `await rateLimitAPIRequest(organizationId)` –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º API –∑–∞–ø—Ä–æ—Å–æ–º
      - [ ] –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç: `await client.getContactById(message.from).catch(() => null)` (‚ö†Ô∏è `client` - —ç—Ç–æ WhatsAppClient, –Ω–µ Prisma Client)
      - [ ] –ï—Å–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç –Ω–∞–π–¥–µ–Ω - –ø–æ–ª—É—á–∞–µ—Ç –∞–≤–∞—Ç–∞—Ä: `await contact.getProfilePicUrl().catch(() => null)`
      - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–µ –≤ –ë–î (–∏–º—è, –∞–≤–∞—Ç–∞—Ä) —á–µ—Ä–µ–∑ `prisma.client.update`
    - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ `MessageHandler.handleIncomingMessage()` (–ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
    - [ ] –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç –∞–≥–µ–Ω—Ç–∞ - –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π:
      - [ ] ‚ö†Ô∏è **–°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º**: `delay: randomDelay(2000, 10000)` (2-10 —Å–µ–∫)
      - [ ] –≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –Ω–∞ "—Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ" —á–µ–ª–æ–≤–µ–∫–∞
    - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success: true, messageId }`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async rateLimitAPIRequest(organizationId: string): Promise<void>`:
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
  - [ ] –ö–ª—é—á: `whatsapp:api-limits:${organizationId}:minute`
  - [ ] –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Å—á–µ—Ç—á–∏–∫
  - [ ] –ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ > 5 - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É `RateLimitError`
  - [ ] ‚ö†Ô∏è **–°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏**: `await sleep(randomDelay(500, 2000))` (0.5-2 —Å–µ–∫)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async addIncomingMessageJob(data: { organizationId, message }): Promise<void>`:
  - [ ] –î–æ–±–∞–≤–ª—è–µ—Ç job –≤ –æ—á–µ—Ä–µ–¥—å —Å —Ç–∏–ø–æ–º `process-incoming`
  - [ ] ‚ö†Ô∏è **–°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π**: `delay: randomDelay(2000, 5000)` (2-5 —Å–µ–∫)
  - [ ] –≠—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –∏ –¥–µ–ª–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private randomDelay(min: number, max: number): number`:
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –º–µ–∂–¥—É `min` –∏ `max` (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async close(): Promise<void>`:
  - [ ] –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –û—á–µ—Ä–µ–¥—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] ‚ö†Ô∏è **Rate Limiting API**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã (–Ω–µ –±–æ–ª–µ–µ 5/–º–∏–Ω—É—Ç—É)
- [ ] ‚ö†Ô∏è **–°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏**: –ó–∞–¥–µ—Ä–∂–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (2-5 —Å–µ–∫ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π, 2-10 —Å–µ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º)
- [ ] Jobs –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã –¥–µ–ª–∞—é—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è Incoming Queue

#### –®–∞–≥ 3.2: –°–æ–∑–¥–∞–Ω–∏–µ Message Handler —Å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä—Å–µ—Ä–æ–≤
**–í—Ä–µ–º—è**: 3-4 —á–∞—Å–∞

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/handlers/message-handler.ts`:
  - [ ] –ö–ª–∞—Å—Å `WhatsAppMessageHandler`
  - [ ] –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `agentOrchestrator?: AgentOrchestrator` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
- [ ] ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ `@soul-kg-crm/data-import`:
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `packages/data-import/src/index.ts` - –≤—Å–µ –ø–∞—Ä—Å–µ—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `packages/data-import/src/parsers/index.ts` - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `packages/data-import/src/importers/index.ts` - –≤—Å–µ –∏–º–ø–æ—Ä—Ç–µ—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `packages/data-import/src/validators/index.ts` - –≤—Å–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä—ã –∏–∑ `@soul-kg-crm/data-import`:
  - [ ] `detectLanguage` –∏–∑ `parsers/language-detector` (–∏–ª–∏ `@soul-kg-crm/data-import/parsers/language-detector`)
  - [ ] `detectCulturalContext` –∏–∑ `parsers/cultural-context-detector`
  - [ ] `extractBestName` –∏–∑ `parsers/name-extractor`
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç–µ—Ä—ã –∏–∑ `@soul-kg-crm/data-import`:
  - [ ] `importClient` –∏–∑ `importers/client-importer`
  - [ ] `importConversation` –∏–∑ `importers/conversation-importer`
- [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∏–∑ `@soul-kg-crm/data-import`:
  - [ ] `checkDuplicate` –∏–∑ `validators/duplicate-detector`
- [ ] ‚ö†Ô∏è **–ò–º–ø–æ—Ä—Ç —Ç–∏–ø–æ–≤**: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏–∑ `@soul-kg-crm/data-import`:
  - [ ] `ParsedClientData` –∏–∑ `types/import.types`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∏–ø—ã —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: `handleIncomingMessage` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `WhatsAppIncomingQueue.processIncoming`, –ù–ï –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Å–æ–±—ã—Ç–∏—è `client.on('message')`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `async handleIncomingMessage(data: { organizationId, from, body, messageId, timestamp, conversationId? })`:
  - [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `WhatsAppIncomingQueue.processIncoming`, –≥–¥–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:
    - [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î
    - [ ] –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ –∞–≤–∞—Ç–∞—Ä–∞ (—Å rate limiting)
  - [ ] –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ shared —Ñ—É–Ω–∫—Ü–∏—é `extractPhoneFromWhatsAppId(from)`
  - [ ] –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ —á–µ—Ä–µ–∑ `detectLanguage(body)`
  - [ ] –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ `detectCulturalContext(body, language)`
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ `checkDuplicate(organizationId, { phone })`
  - [ ] –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
    - [ ] –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è —á–µ—Ä–µ–∑ `extractBestName(null, body)` (–∏–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–æ –≤ –æ—á–µ—Ä–µ–¥–∏)
    - [ ] ‚ö†Ô∏è **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç `ParsedClientData`:
      - [ ] `phone: extractedPhone`
      - [ ] `name: extractedName` (–º–æ–∂–µ—Ç –±—ã—Ç—å null, –Ω–æ –æ–±—ã—á–Ω–æ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–æ –∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞)
      - [ ] `email: null` (–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏)
      - [ ] `preferredLanguage: detectedLanguage`
      - [ ] `metadata: { culturalContext: detectedCulturalContext }`
      - [ ] `detectedStatus: ClientStatus.NEW_LEAD` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum –∏–∑ `@soul-kg-crm/database`)
    - [ ] –°–æ–∑–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ `importClient(organizationId, parsedClientData, undefined)`
  - [ ] –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ –∏–∑ –ë–î
  - [ ] –°–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä —á–µ—Ä–µ–∑ `importConversation(organizationId, clientId, CommunicationChannel.WHATSAPP)` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum)
  - [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –°–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î –≤ `WhatsAppIncomingQueue`, –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑–∏
  - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç `lastMessageAt` –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ
  - [ ] **TODO (–≠—Ç–∞–ø 4)**: –ü–µ—Ä–µ–¥–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `agentOrchestrator.processMessage()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞
  - [ ] **TODO (–≠—Ç–∞–ø 4)**: –ï—Å–ª–∏ –∞–≥–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª –æ—Ç–≤–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ `WhatsAppIncomingQueue`)
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ gracefully (–ª–æ–≥–∏—Ä—É–µ—Ç, –Ω–æ –Ω–µ –ø–∞–¥–∞–µ—Ç)
- [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `WhatsAppIncomingQueue`:
  - [ ] `WhatsAppIncomingQueue` –≤—ã–∑—ã–≤–∞–µ—Ç `handleIncomingMessage` –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
  - [ ] `handleIncomingMessage` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç –∞–≥–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
  - [ ] `WhatsAppIncomingQueue` –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private extractPhoneNumber(whatsappId: string): string`:
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç shared —Ñ—É–Ω–∫—Ü–∏—é `extractPhoneFromWhatsAppId`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `private async getRecentMessages(conversationId: string, limit: number = 10)`:
  - [ ] –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –ë–î –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∞–≥–µ–Ω—Ç–∞–º–∏)
- [ ] –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] ‚ö†Ô∏è **–≠–∫—Å–ø–æ—Ä—Ç—ã**: –ü–∞—Ä—Å–µ—Ä—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑ `@soul-kg-crm/data-import` (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è)
- [ ] ‚ö†Ô∏è **–¢–∏–ø—ã**: –¢–∏–ø—ã `ParsedClientData` —Å–æ–≤–º–µ—Å—Ç–∏–º—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] ‚ö†Ô∏è **Enum –∑–Ω–∞—á–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ enum (ClientStatus, CommunicationChannel, MessageDirection, MessageSender, MessageStatus)
- [ ] –ö–ª–∏–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
- [ ] –†–∞–∑–≥–æ–≤–æ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
- [ ] ‚ö†Ô∏è **MessageStatus**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MessageStatus.PENDING` –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö (–Ω–µ RECEIVED, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ enum)
- [ ] –Ø–∑—ã–∫ –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î—É–±–ª–∏–∫–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è Message Handler

#### –®–∞–≥ 3.3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Handler —Å Client –∏ Incoming Queue
**–í—Ä–µ–º—è**: 1 —á–∞—Å

- [ ] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `SessionManager`, –ù–ï –Ω–∞–ø—Ä—è–º—É—é –≤ `WhatsAppClient`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `packages/whatsapp/src/client/session-manager.ts`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `setIncomingQueue(incomingQueue: WhatsAppIncomingQueue): void`
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `message` –≤ `setupClientEvents()` –¥–ª—è –≤—ã–∑–æ–≤–∞ `incomingQueue.addIncomingMessageJob()`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `packages/whatsapp/src/queue/incoming-queue.ts`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `messageHandler: WhatsAppMessageHandler` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
  - [ ] –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `process-incoming`:
    - [ ] –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ –∞–≤–∞—Ç–∞—Ä–∞ –≤—ã–∑—ã–≤–∞—Ç—å `messageHandler.handleIncomingMessage()`
    - [ ] –ï—Å–ª–∏ handler –≤–µ—Ä–Ω—É–ª –æ—Ç–≤–µ—Ç –æ—Ç –∞–≥–µ–Ω—Ç–∞ - –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (2-10 —Å–µ–∫)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `packages/whatsapp/src/index.ts`:
  - [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è `initializeWhatsAppModule()`:
    - [ ] –°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã `WhatsAppSessionManager`, `WhatsAppMessageQueue`, `WhatsAppIncomingQueue`
    - [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤—è–∑–∏: `sessionManager.setIncomingQueue(incomingQueue)`, `incomingQueue` –ø–æ–ª—É—á–∞–µ—Ç `sendQueue` –∏ `sessionManager`
    - [ ] ‚ö†Ô∏è **Graceful shutdown**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–π:
      - [ ] `process.on('SIGTERM', async () => { await sessionManager.disconnectAll(); await messageQueue.close(); await incomingQueue.close(); })`
      - [ ] `process.on('SIGINT', async () => { await sessionManager.disconnectAll(); await messageQueue.close(); await incomingQueue.close(); })`
      - [ ] –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
    - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ API routes
  - [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `WhatsAppMessageHandler`
  - [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `WhatsAppMessageQueue`
  - [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `WhatsAppIncomingQueue`
  - [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `WhatsAppSessionManager`
- [ ] ‚ö†Ô∏è **–ü—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤**: –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/api/agent-api.ts`:
  - [ ] –§—É–Ω–∫—Ü–∏—è `sendMessageForAgent(organizationId, to, content, conversationId, agentType): Promise<void>`
    - [ ] –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `messageQueue.addSendMessageJob` —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º 5 (high –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤)
    - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `sender: MessageSender.AI`
    - [ ] –õ–æ–≥–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  - [ ] –§—É–Ω–∫—Ü–∏—è `sendBulkMessagesForAgent(organizationId, messages, agentType): Promise<BulkSendResult>`
    - [ ] –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `messageQueue.addBulkSendJobs` —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
    - [ ] –ê–≥–µ–Ω—Ç—ã –∏–º–µ—é—Ç –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ª–∏–º–∏—Ç—ã (–Ω–µ –±–æ–ª–µ–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑)
  - [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `packages/whatsapp/src/index.ts`:
    ```typescript
    export { sendMessageForAgent, sendBulkMessagesForAgent } from './api/agent-api';
    ```

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Message Handler
- [ ] –ö–ª–∏–µ–Ω—Ç—ã –∏ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

---

### –≠—Ç–∞–ø 4: API Endpoints –∏ —É—Ç–∏–ª–∏—Ç—ã (–î–µ–Ω—å 4)
**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WhatsApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

#### –®–∞–≥ 4.0: –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
**–í—Ä–µ–º—è**: 30 –º–∏–Ω—É—Ç

- [ ] –°–æ–∑–¥–∞—Ç—å `packages/whatsapp/src/utils/settings.ts`:
  - [ ] –§—É–Ω–∫—Ü–∏—è `async getWhatsAppSettings(organizationId: string): Promise<WhatsAppSettings>`:
    - [ ] –ü–æ–ª—É—á–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏–∑ –ë–î —á–µ—Ä–µ–∑ `prisma.organization.findUnique`
    - [ ] –ò–∑–≤–ª–µ–∫–∞–µ—Ç `settings.whatsapp` –∏–∑ JSON –ø–æ–ª—è
    - [ ] –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `getDefaultWhatsAppSettings()` –∏–∑ shared
    - [ ] –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `validateWhatsAppSettings`
  - [ ] –§—É–Ω–∫—Ü–∏—è `async updateWhatsAppSettings(organizationId: string, settings: Partial<WhatsAppSettings>): Promise<WhatsAppSettings>`:
    - [ ] –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç `Organization.settings.whatsapp` —á–µ—Ä–µ–∑ `prisma.organization.update`
    - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `{ settings: { ...existingSettings, whatsapp: newSettings } }` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
  - [ ] –§—É–Ω–∫—Ü–∏—è `async checkRateLimit(organizationId: string, count: number = 1): Promise<{allowed: boolean, remaining: number, resetAt: Date}>`:
    - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã —á–µ—Ä–µ–∑ Redis —Å—á–µ—Ç—á–∏–∫–∏
    - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á–∏: `whatsapp:limits:${organizationId}:minute/hour/day`
    - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–∞—Ö
  - [ ] –§—É–Ω–∫—Ü–∏—è `async incrementRateLimit(organizationId: string, count: number = 1): Promise<void>`:
    - [ ] –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫–∏ –≤ Redis
    - [ ] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç TTL –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ (60 —Å–µ–∫ –¥–ª—è –º–∏–Ω—É—Ç—ã, 3600 –¥–ª—è —á–∞—Å–∞, 86400 –¥–ª—è –¥–Ω—è)

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î
- [ ] –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ—Ç

#### –®–∞–≥ 4.1: –°–æ–∑–¥–∞–Ω–∏–µ routes
**–í—Ä–µ–º—è**: 3-4 —á–∞—Å–∞

- [ ] –°–æ–∑–¥–∞—Ç—å `apps/api/src/routes/whatsapp.routes.ts`:
  - [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `Router` –∏–∑ Express
  - [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å middleware: `authenticateToken`, `requireRole`
  - [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `WhatsAppSessionManager`, `WhatsAppMessageQueue` –∏–∑ `@soul-kg-crm/whatsapp`
  - [ ] –°–æ–∑–¥–∞—Ç—å router: `const router = Router()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /api/whatsapp/connect`:
  - [ ] Middleware: `authenticateToken`, `requireRole('ADMIN', 'SUPER_ADMIN')`
  - [ ] –ü–æ–ª—É—á–∞–µ—Ç `organizationId` –∏–∑ `req.user.organizationId`
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `sessionManager.getOrCreateClient(organizationId)`
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success: true, organizationId, status: WhatsAppSessionStatus.CONNECTING }` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum, –Ω–µ —Å—Ç—Ä–æ–∫—É)
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (400, 500)
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GET /api/whatsapp/qr/:organizationId`:
  - [ ] Middleware: `authenticateToken`
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `organizationId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `req.user.organizationId` (–∏–ª–∏ ADMIN)
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `sessionManager.getQRCode(organizationId)`
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ qrCode }` –∏–ª–∏ `{ qrCode: null }` –µ—Å–ª–∏ –Ω–µ—Ç
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (403, 404, 500)
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GET /api/whatsapp/status/:organizationId`:
  - [ ] Middleware: `authenticateToken`
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `organizationId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `req.user.organizationId` (–∏–ª–∏ ADMIN)
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `sessionManager.getStatus(organizationId)`
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ organizationId, status, lastConnectedAt, lastDisconnectedAt, errorMessage }`
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (403, 404, 500)
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /api/whatsapp/disconnect/:organizationId`:
  - [ ] Middleware: `authenticateToken`, `requireRole('ADMIN', 'SUPER_ADMIN')`
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `organizationId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `req.user.organizationId` (–∏–ª–∏ ADMIN)
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `sessionManager.disconnect(organizationId)`
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success: true, organizationId, status: WhatsAppSessionStatus.DISCONNECTED }` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum, –Ω–µ —Å—Ç—Ä–æ–∫—É)
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (403, 404, 500)
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /api/whatsapp/send`:
  - [ ] Middleware: `authenticateToken`
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è body —á–µ—Ä–µ–∑ Zod:
    - [ ] `organizationId: string` (UUID)
    - [ ] `to: string` (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
    - [ ] `content: string` (min 1, max 4096)
    - [ ] `conversationId: string` (UUID, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    - [ ] `priority: number` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 1-10, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `organizationId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `req.user.organizationId`
  - [ ] –ï—Å–ª–∏ `conversationId` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω - —Å–æ–∑–¥–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `messageQueue.addSendMessageJob({ organizationId, to, content, conversationId, sender: MessageSender.HUMAN, priority })` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum, –Ω–µ —Å—Ç—Ä–æ–∫—É)
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success: true, message: 'Message queued for sending' }`
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (400, 403, 429 Rate Limit, 500)
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `POST /api/whatsapp/send/bulk`:
  - [ ] Middleware: `authenticateToken`, `requireRole('ADMIN', 'SUPER_ADMIN')` (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è body —á–µ—Ä–µ–∑ Zod:
    - [ ] `organizationId: string` (UUID)
    - [ ] `messages: Array<{to: string, content: string, conversationId?: string}>` (min 1, max 100)
    - [ ] `requireConfirmation: boolean` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true –µ—Å–ª–∏ >10 —Å–æ–æ–±—â–µ–Ω–∏–π)
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `organizationId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `req.user.organizationId`
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (`enableMassSending`, `requireConfirmation`)
  - [ ] –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π > `maxBatchSize` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  - [ ] –í—ã–∑—ã–≤–∞–µ—Ç `messageQueue.addBulkSendJobs({ organizationId, messages, sender: MessageSender.HUMAN })` (‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum, –Ω–µ —Å—Ç—Ä–æ–∫—É)
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ success: true, queued: number, failed: number, errors: [...] }`
  - [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ (400, 403, 429 Rate Limit, 500)
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GET /api/whatsapp/settings/:organizationId`:
  - [ ] Middleware: `authenticateToken`
  - [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ `organizationId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `req.user.organizationId` (–∏–ª–∏ ADMIN)
  - [ ] –ü–æ–ª—É—á–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp –∏–∑ `Organization.settings.whatsapp`
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `PUT /api/whatsapp/settings/:organizationId`:
  - [ ] Middleware: `authenticateToken`, `requireRole('ADMIN', 'SUPER_ADMIN')`
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è body —á–µ—Ä–µ–∑ Zod (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp)
  - [ ] –û–±–Ω–æ–≤–ª—è–µ—Ç `Organization.settings.whatsapp` —á–µ—Ä–µ–∑ `prisma.organization.update`
  - [ ] –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è (–ª–∏–º–∏—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑—É–º–Ω—ã–º–∏)
  - [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - [ ] JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å router: `export default router`

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ endpoints –∏–º–µ—é—Ç JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (Zod schemas)
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π)
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Integration —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö endpoints

#### –®–∞–≥ 4.2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è routes –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
**–í—Ä–µ–º—è**: 15 –º–∏–Ω—É—Ç

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `apps/api/src/app.ts`:
  - [ ] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `whatsappRouter` –∏–∑ `routes/whatsapp.routes`
  - [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å: `app.use('/api/whatsapp', whatsappRouter)`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ routes –¥–æ—Å—Ç—É–ø–Ω—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] Routes –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ `/api/whatsapp/*`
- [ ] Middleware –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –≠—Ç–∞–ø 5: Frontend UI (–î–µ–Ω—å 4-5)
**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è WhatsApp

#### –®–∞–≥ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª–∏–µ–Ω—Ç–∞
**–í—Ä–µ–º—è**: 1 —á–∞—Å

- [ ] –°–æ–∑–¥–∞—Ç—å `apps/web/lib/api/whatsapp.ts`:
  - [ ] `connectWhatsApp()` - POST `/api/whatsapp/connect`
  - [ ] `getQRCode(organizationId)` - GET `/api/whatsapp/qr/:organizationId`
  - [ ] `getStatus(organizationId)` - GET `/api/whatsapp/status/:organizationId`
  - [ ] `disconnectWhatsApp(organizationId)` - POST `/api/whatsapp/disconnect/:organizationId`
  - [ ] `sendMessage(data)` - POST `/api/whatsapp/send`
  - [ ] `sendBulkMessages(data)` - POST `/api/whatsapp/send/bulk`
  - [ ] `getWhatsAppSettings(organizationId)` - GET `/api/whatsapp/settings/:organizationId`
  - [ ] `updateWhatsAppSettings(organizationId, settings)` - PUT `/api/whatsapp/settings/:organizationId`
- [ ] –°–æ–∑–¥–∞—Ç—å React hooks:
  - [ ] `useWhatsAppConnection()` - –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
  - [ ] `useWhatsAppStatus()` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
  - [ ] `useSendWhatsAppMessage()` - –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - [ ] `useBulkSendWhatsAppMessage()` - –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
  - [ ] `useWhatsAppSettings()` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] API –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Hooks –∏—Å–ø–æ–ª—å–∑—É—é—Ç React Query –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

#### –®–∞–≥ 5.2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WhatsApp –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
**–í—Ä–µ–º—è**: 3-4 —á–∞—Å–∞

- [ ] –°–æ–∑–¥–∞—Ç—å `apps/web/app/dashboard/settings/whatsapp/page.tsx`:
  - [ ] Server Component –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [ ] –°–æ–∑–¥–∞—Ç—å `apps/web/components/features/whatsapp/WhatsAppConnection.tsx`:
  - [ ] –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å" / "–û—Ç–∫–ª—é—á–∏—Ç—å"
  - [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ QR-–∫–æ–¥–∞ (–µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `QR_CODE_PENDING`)
  - [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ (Connected, Disconnected, Connecting, Error)
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useWhatsAppConnection()`, `useWhatsAppStatus()`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `qrcode.react` –∏–ª–∏ `react-qr-code`
  - [ ] –û–±–Ω–æ–≤–ª—è—Ç—å QR-–∫–æ–¥ —á–µ—Ä–µ–∑ polling (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –ø–æ–∫–∞ —Å—Ç–∞—Ç—É—Å `QR_CODE_PENDING`)
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é (ru/en) –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ loading states
- [ ] –°–æ–∑–¥–∞—Ç—å `apps/web/components/features/whatsapp/WhatsAppSettings.tsx`:
  - [ ] –§–æ—Ä–º–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ rate limiting (messagesPerMinute, messagesPerHour, messagesPerDay, concurrency)
  - [ ] –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å `enableMassSending`
  - [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `requireConfirmation` –∏ `maxBatchSize`
  - [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Ä–∏—Å–∫–∞—Ö –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useWhatsAppSettings()` hook
- [ ] –°–æ–∑–¥–∞—Ç—å `apps/web/components/features/whatsapp/WhatsAppBulkSend.tsx`:
  - [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
  - [ ] –í—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–æ–≤ (—á–µ—Ä–µ–∑ —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤—ã–±–æ—Ä)
  - [ ] –ü–æ–ª–µ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è (—Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º)
  - [ ] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
  - [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–∫–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å)
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useBulkSendWhatsAppMessage()` hook

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ `/dashboard/settings/whatsapp`
- [ ] QR-–∫–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Mobile-friendly –¥–∏–∑–∞–π–Ω

#### –®–∞–≥ 5.3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ ConversationView
**–í—Ä–µ–º—è**: 1-2 —á–∞—Å–∞

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `apps/web/components/features/clients/ConversationView.tsx`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–Ω–∞–ª–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (`channel === 'WHATSAPP'`)
  - [ ] –ï—Å–ª–∏ WhatsApp - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useSendWhatsAppMessage()` –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ (queued, sending, sent, failed)
  - [ ] –û–±–Ω–æ–≤–ª—è—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WhatsApp
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ WhatsApp –æ—á–µ—Ä–µ–¥—å
- [ ] –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –≠—Ç–∞–ø 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ —Å UI –∏ –∏–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (–î–µ–Ω—å 5, –Ω–∞—á–∞–ª–æ)
**–¶–µ–ª—å**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —Å –Ω–æ–≤–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π, –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–µ—Å—Å–∏–π

#### –®–∞–≥ 6.0: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ —Å WhatsApp –º–æ–¥—É–ª–µ–º
**–í—Ä–µ–º—è**: 2-3 —á–∞—Å–∞

- [ ] ‚ö†Ô∏è **–ò–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π**:
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏–º–ø–æ—Ä—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `clientId: import-${organizationId}` (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ shared —É—Ç–∏–ª–∏—Ç–∞—Ö)
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `clientId: org-${organizationId}` (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ shared —É—Ç–∏–ª–∏—Ç–∞—Ö)
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–µ—Å—Å–∏–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å `apps/web/app/dashboard/settings/import/page.tsx`:
  - [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ WhatsApp
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints `/api/import/whatsapp/*`
  - [ ] –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç QR-–∫–æ–¥ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞
  - [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ç–æ–º —á—Ç–æ –∏–º–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `apps/web/components/features/whatsapp/WhatsAppConnection.tsx`:
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º —á—Ç–æ —ç—Ç–æ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
  - [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
  - [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: "–î–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª –ò–º–ø–æ—Ä—Ç"
- [ ] ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ**:
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `checkDuplicate` –∏–∑ `data-import` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - [ ] –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
  - [ ] –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ `whatsappMessageId`
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ UI –∏–º–ø–æ—Ä—Ç–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `apps/web/components/features/import/WhatsAppImport.tsx`:
  - [ ] –§–æ—Ä–º–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∞:
    - [ ] `importContacts: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
    - [ ] `importMessages: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
    - [ ] `detectStatus: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
    - [ ] `useLLMStatusDetection: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)
    - [ ] `skipDuplicates: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
    - [ ] `dryRun: boolean` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∏–º–ø–æ—Ä—Ç"
  - [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ QR-–∫–æ–¥–∞ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞ (—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, —Å–∫–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω–æ, —Å–∫–æ–ª—å–∫–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
  - [ ] –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç"
  - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useWhatsAppImport()` hook

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –ò–º–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç (—Ä–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏)
- [ ] –î—É–±–ª–∏–∫–∞—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- [ ] UI –∏–º–ø–æ—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞ (–î–µ–Ω—å 5)
**–¶–µ–ª—å**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π flow –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

#### –®–∞–≥ 7.1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–í—Ä–µ–º—è**: 2-3 —á–∞—Å–∞

- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π flow –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
  - [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ QR-–∫–æ–¥–∞ ‚Üí —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π:
  - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ API ‚Üí –æ—á–µ—Ä–µ–¥—å ‚Üí WhatsApp ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ retry –ª–æ–≥–∏–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π:
  - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ WhatsApp ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ä–∞–∑–≥–æ–≤–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —è–∑—ã–∫ –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
  - [ ] –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞–∑—Ä—ã–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ exponential backoff
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
  - [ ] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
  - [ ] –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 429
  - [ ] –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
  - [ ] –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Å—Å–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É:
  - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ 10 —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ 100 —Å–æ–æ–±—â–µ–Ω–∏–π —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
  - [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –∞–≥–µ–Ω—Ç–∞–º–∏:
  - [ ] –ê–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `sendMessageForAgent`
  - [ ] –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç –∏–∑ UI:
  - [ ] –ò–º–ø–æ—Ä—Ç –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
  - [ ] –î—É–±–ª–∏–∫–∞—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è
  - [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –í—Å–µ flow —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- [ ] –°–µ—Å—Å–∏–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç –º–µ–∂–¥—É –∏–º–ø–æ—Ä—Ç–æ–º –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- [ ] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

#### –®–∞–≥ 7.2: –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
**–í—Ä–µ–º—è**: 1-2 —á–∞—Å–∞

- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ WhatsApp –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:
  - [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ –æ—à–∏–±–∫–∞–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  - [ ] –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ —Å–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞:
  - [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π —Å–µ—Å—Å–∏–∏
  - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º QR-–∫–æ–¥–æ–º
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
  - [ ] Graceful degradation (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –≤–º–µ—Å—Ç–æ –æ—á–µ—Ä–µ–¥–∏)
  - [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
  - [ ] Retry –ª–æ–≥–∏–∫–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π:
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–æ–º–µ—Ä–∞
  - [ ] –ü–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –ø—Ä–µ–≤—ã—à–µ–Ω rate limit:
  - [ ] –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ 429 —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏–º–∏—Ç–∞—Ö
  - [ ] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º –∫–æ–≥–¥–∞ –ª–∏–º–∏—Ç —Å–±—Ä–æ—Å–∏—Ç—Å—è
  - [ ] –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –º–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
  - [ ] –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ 400 —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  - [ ] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ä–∏—Å–∫–∞—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –í—Å–µ edge cases –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

#### –®–∞–≥ 7.3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–í—Ä–µ–º—è**: 1 —á–∞—Å

- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `findUnique` –≤–º–µ—Å—Ç–æ `findFirst` –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
  - [ ] –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è (`organizationId`, `whatsappMessageId`)
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏:
  - [ ] Batch processing –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  - [ ] –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –≤–∞–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏:
  - [ ] –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π –∏–∑ –ø–∞–º—è—Ç–∏
  - [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∏**:
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞—è
- [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- [ ] –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**: `docs/integrations/whatsapp-web-integration.md`
- **–ü–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç–∞**: `PROJECT_PLAN.md` (–≠—Ç–∞–ø 2)
- **–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞**: `PROJECT_STATUS.md`
- **–ú–æ–¥—É–ª—å data-import**: `packages/data-import/README.md`
- **–°—Ö–µ–º–∞ –ë–î**: `packages/database/prisma/schema.prisma` (WhatsAppSession –º–æ–¥–µ–ª—å)
- **Developer Guidelines**: `docs/architecture/DEVELOPER_GUIDELINES.md`

## üîÑ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã

### –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ
- ‚úÖ –ú–æ–¥—É–ª—å `data-import` –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–∞—Ä—Å–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (language, status, cultural context)
- ‚úÖ –ò–º–ø–æ—Ä—Ç–µ—Ä—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î (clients, conversations, messages)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–æ–¥–µ–ª—å `WhatsAppSession` –≤ –ë–î
- ‚úÖ API endpoints –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `whatsapp` –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å long-running WhatsApp –∫–ª–∏–µ–Ω—Ç
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (BullMQ)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–æ–∑–¥–∞—Ç—å API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- –°–æ–∑–¥–∞—Ç—å Frontend UI –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WhatsApp

### –ë–ª–æ–∫–µ—Ä—ã
- ‚ö†Ô∏è **Redis**: Redis –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è BullMQ (–¥–æ–±–∞–≤–∏—Ç—å –≤ `.env.example` –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
- ‚ö†Ô∏è **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —ç–∫—Å–ø–æ—Ä—Ç—ã –∏–∑ `@soul-kg-crm/data-import` –¥–æ—Å—Ç—É–ø–Ω—ã

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–∏–∑ –∞–Ω–∞–ª–∏–∑–∞)

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ WhatsApp**:
   - –í—ã–Ω–µ—Å—Ç–∏ rate limiting –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (`Organization.settings.whatsapp`)
   - –°–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   - –ü–æ–∑–≤–æ–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã

2. **–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞**:
   - –°–æ–∑–¥–∞—Ç—å endpoint –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–æ–Ω—Ç–∞–∫—Ç–∞–º
   - –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏**:
   - –ú–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ê–≥–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `WhatsAppMessageQueue`
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤

4. **–ò–º–ø–æ—Ä—Ç –∏–∑ UI**:
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö —Å –Ω–æ–≤–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π WhatsApp
   - –ò–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π (–∏–º–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –¥–æ–ª–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å)
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ UI
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ

### –ó–∞–º–µ—Ç–∫–∏ –∏ –≤–∞–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è**:
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–æ–≤/–∏–º–ø–æ—Ä—Ç–µ—Ä–æ–≤ –∏–∑ `data-import`, –Ω–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π**: –†–∞–∑–Ω—ã–µ `clientId` –∏ `dataPath` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–∏–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
- **Shared —É—Ç–∏–ª–∏—Ç—ã**: –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ WhatsApp –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `packages/shared`
- **–û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π**: BullMQ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å retry –ª–æ–≥–∏–∫–æ–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: Exponential backoff –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

**–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞**:
- ‚ö†Ô∏è **–ù–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–º–ø–æ—Ä—Ç** - `data-import` –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ö†Ô∏è **–†–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏** - –∏–º–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–∞–ø–∫–∏ —Å–µ—Å—Å–∏–π
- ‚ö†Ô∏è **Graceful degradation** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö WhatsApp
- ‚ö†Ô∏è **Rate limiting** - —Å–æ–±–ª—é–¥–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è WhatsApp (20 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É)
- ‚ö†Ô∏è **–ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏–º–µ–µ—Ç —Å–≤–æ—é —Å–µ—Å—Å–∏—é

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
- WhatsApp –∫–ª–∏–µ–Ω—Ç: `whatsapp-web.js` –≤–µ—Ä—Å–∏–∏ 1.23.0+
- –û—á–µ—Ä–µ–¥—å: BullMQ —Å Redis (‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è Redis URL –∏–ª–∏ HOST/PORT –≤ env)
- –°–µ—Å—Å–∏–∏: LocalAuth —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ `.whatsapp-sessions/`
  - –ò–º–ø–æ—Ä—Ç: `import-${organizationId}` (—Ä–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: `org-${organizationId}` (–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è)
- –§–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–æ–≤: –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (`+996555123456` ‚Üí `996555123456@c.us`)
- Prisma –º–æ–¥–µ–ª–∏: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å camelCase –∏–º–µ–Ω–∞ (`whatsAppSession`, –Ω–µ `WhatsAppSession`)
- Enum –∑–Ω–∞—á–µ–Ω–∏—è: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum –∏–∑ `@soul-kg-crm/database` –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫
- MessageStatus: –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `PENDING`, `SENT`, `DELIVERED`, `FAILED` (‚ö†Ô∏è –ù–ï–¢ `RECEIVED`)
- Rate Limiting: 
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É, 100/—á–∞—Å, 500/–¥–µ–Ω—å (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
  - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Organization.settings.whatsapp.rateLimiting`
  - Concurrency: 3 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
- –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞:
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–∞ (`enableMassSending: false`)
  - –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è >10 —Å–æ–æ–±—â–µ–Ω–∏–π (`requireConfirmation: true`)
  - –ú–∞–∫—Å–∏–º—É–º 50 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑ (`maxBatchSize: 50`)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏:
  - –ü—É–±–ª–∏—á–Ω—ã–π API: `sendMessageForAgent()`, `sendBulkMessagesForAgent()`
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤: 5 (high)
  - –õ–∏–º–∏—Ç—ã –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤: –Ω–µ –±–æ–ª–µ–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–æ–≤—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ WhatsApp

**–ü—Ä–æ–±–ª–µ–º–∞**: Rate limiting –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω –≤ –∫–æ–¥–µ, –Ω–µ–ª—å–∑—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

**–†–µ—à–µ–Ω–∏–µ**: 
- –•—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `Organization.settings.whatsapp` (JSON –ø–æ–ª–µ)
- –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É –≤–º–µ—Å—Ç–æ 20)
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å —á–µ—Ä–µ–∑ UI
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ Redis —Å—á–µ—Ç—á–∏–∫–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫**:
```typescript
{
  rateLimiting: {
    messagesPerMinute: 10,  // –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ (–±—ã–ª–æ 20)
    messagesPerHour: 100,
    messagesPerDay: 500,
    concurrency: 3          // –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ (–±—ã–ª–æ 5)
  },
  safety: {
    enableMassSending: false,      // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–æ
    requireConfirmation: true,      // –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    maxBatchSize: 50               // –ú–∞–∫—Å–∏–º—É–º –∑–∞ —Ä–∞–∑
  }
}
```

**–†–∏—Å–∫–∏**:
- ‚ö†Ô∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ UI, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–µ –±–æ–ª–µ–µ 20/–º–∏–Ω), –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2. –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù—É–∂–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–º —Å–æ–æ–±—â–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ**:
- Endpoint `POST /api/whatsapp/send/bulk` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (`enableMassSending`, `requireConfirmation`)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (–∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á–µ—Ä–µ–∑ Redis/–ë–î

**–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞**:
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–æ (`enableMassSending: false`)
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è >10 —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–≥–æ –ª–∏–º–∏—Ç–∞ –Ω–∞ –¥–µ–Ω—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –ú–∞–∫—Å–∏–º—É–º 50 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

**–†–∏—Å–∫–∏**:
- ‚ö†Ô∏è –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∞–∫–∫–∞—É–Ω—Ç–∞
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ UI

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ê–≥–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ WhatsApp –º–æ–¥—É–ª—å.

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—É–±–ª–∏—á–Ω—ã–π API: `sendMessageForAgent()`, `sendBulkMessagesForAgent()`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤: 5 (high)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ (–Ω–µ –±–æ–ª–µ–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
Agent Orchestrator (–≠—Ç–∞–ø 4)
    ‚Üì
import { sendMessageForAgent } from '@soul-kg-crm/whatsapp';
    ‚Üì
sendMessageForAgent(organizationId, to, content, conversationId, agentType)
    ‚Üì
WhatsAppMessageQueue.addSendMessageJob() —Å priority: 5
    ‚Üì
BullMQ Queue ‚Üí WhatsApp Client
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞–º–∏**:
```typescript
// –í Agent Orchestrator –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∞–≥–µ–Ω—Ç–µ
import { sendMessageForAgent } from '@soul-kg-crm/whatsapp';

// –ê–≥–µ–Ω—Ç —Ä–µ—à–∏–ª –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
await sendMessageForAgent(
  organizationId,
  clientPhone,
  agentResponse,
  conversationId,
  'QUALIFICATION' // agentType –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
);
```

**–†–∏—Å–∫–∏**:
- ‚ö†Ô∏è –ê–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: 
  - –õ–∏–º–∏—Ç—ã –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ (–Ω–µ –±–æ–ª–µ–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑)
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (5 = high, –Ω–æ –Ω–µ urgent)
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### 4. –ò–º–ø–æ—Ä—Ç –∏–∑ UI –∏ –∏–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù—É–∂–µ–Ω –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ UI, –Ω–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π.

**–†–µ—à–µ–Ω–∏–µ**:
- –†–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏: –∏–º–ø–æ—Ä—Ç (`import-${organizationId}`) –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (`org-${organizationId}`)
- –ò–º–ø–æ—Ä—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints `/api/import/whatsapp/*`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ `checkDuplicate` –∏–∑ `data-import`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ `whatsappMessageId` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (`/dashboard/settings/import`)

**–ò–∑–±–µ–∂–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**:
- ‚úÖ –†–∞–∑–Ω—ã–µ `clientId` –∏ `dataPath` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ò–º–ø–æ—Ä—Ç –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π (–ø–æ–¥–∫–ª—é—á–∏–ª—Å—è ‚Üí –∏–∑–≤–ª–µ–∫ ‚Üí –æ—Ç–∫–ª—é—á–∏–ª—Å—è)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è (long-running)
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–†–∏—Å–∫–∏**:
- ‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: –†–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ UI, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **Prisma –∏–º–µ–Ω–∞ –º–æ–¥–µ–ª–µ–π**:
   - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `prisma.WhatsAppSession`
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `prisma.whatsAppSession` (Prisma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç camelCase)
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Prisma Client –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –º–æ–¥–µ–ª–∏

2. **Enum –∑–Ω–∞—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫**:
   - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `status: 'CONNECTED'`, `direction: 'OUTGOING'`, `sender: 'CLIENT'`
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `status: WhatsAppSessionStatus.CONNECTED`, `direction: MessageDirection.OUTGOING`, `sender: MessageSender.CLIENT`
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum –∏–∑ `@soul-kg-crm/database`

3. **MessageStatus - –Ω–µ—Ç —Å—Ç–∞—Ç—É—Å–∞ RECEIVED**:
   - ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: `status: 'RECEIVED'` (—Ç–∞–∫–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ—Ç –≤ enum)
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: `status: MessageStatus.PENDING` –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - **–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**: `PENDING`, `SENT`, `DELIVERED`, `FAILED`

4. **Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
   - ‚ö†Ô∏è Redis –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ `REDIS_URL` –∏–ª–∏ `REDIS_HOST`/`REDIS_PORT` –≤ `.env`
   - –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –∑–∞–ø—É—Å—Ç–∏—Ç—å Redis —á–µ—Ä–µ–∑ Docker –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
   - –î–æ–±–∞–≤–∏—Ç—å Redis –≤ `.env.example` –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç

5. **–≠–∫—Å–ø–æ—Ä—Ç—ã –∏–∑ data-import**:
   - ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ `@soul-kg-crm/data-import`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `packages/data-import/src/index.ts` –∏ –ø–æ–¥–º–æ–¥—É–ª–∏
   - –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è - –¥–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã

6. **–¢–∏–ø—ã ParsedClientData**:
   - ‚ö†Ô∏è –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–∏–ø `ParsedClientData` —Å–æ–≤–º–µ—Å—Ç–∏–º —Å `importClient`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `importClient`

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã**:
   - ‚ö†Ô∏è –í MVP –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ–¥–∏–∞ –≤ `content` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `[Media: image]`)
   - TODO (post-MVP): –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞

2. **Rate Limiting** (–æ–±–Ω–æ–≤–ª–µ–Ω–æ):
   - ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `Organization.settings.whatsapp`
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ: 10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É, 100/—á–∞—Å, 500/–¥–µ–Ω—å
   - Concurrency: 3 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–µ 5)
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ UI
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ Redis —Å—á–µ—Ç—á–∏–∫–∏
   - ‚ö†Ô∏è **–î–≤–µ –æ—á–µ—Ä–µ–¥–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ rate limiters**:
     - `whatsapp-send`: Rate limiting –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (10/–º–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
     - `whatsapp-incoming-process`: Rate limiting –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ (5/–º–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - ‚ö†Ô∏è **–°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**:
     - –ü–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤—Ö–æ–¥—è—â–µ–≥–æ: 2-5 —Å–µ–∫—É–Ω–¥ (—Å–ª—É—á–∞–π–Ω–æ)
     - –ü–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º: 2-10 —Å–µ–∫—É–Ω–¥ (—Å–ª—É—á–∞–π–Ω–æ)
     - –ú–µ–∂–¥—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ API –∑–∞–ø—Ä–æ—Å–∞–º–∏: 0.5-2 —Å–µ–∫—É–Ω–¥—ã (—Å–ª—É—á–∞–π–Ω–æ)

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å try-catch
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –Ω–æ –Ω–µ –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π)

4. **–ò–Ω–¥–µ–∫—Å—ã –ë–î**:
   - ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `organizationId` –≤ `whatsapp_sessions` (–µ—Å—Ç—å unique constraint, –Ω–æ –∏–Ω–¥–µ–∫—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω)
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `whatsappMessageId` —É–∂–µ –µ—Å—Ç—å –≤ `messages` —Ç–∞–±–ª–∏—Ü–µ

5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**:
   - ‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `Organization.settings.whatsapp` (JSON –ø–æ–ª–µ)
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ `packages/shared/src/types/whatsapp-settings.ts`
   - –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ (10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É, concurrency: 3)
   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ UI

6. **–ò–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**:
   - –ò–º–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ `clientId` –∏ `dataPath`
   - –ò–º–ø–æ—Ä—Ç: `import-${organizationId}`, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: `org-${organizationId}`
   - –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ `checkDuplicate` –∏–∑ `data-import`
   - –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–æ `whatsappMessageId` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤ (WhatsAppClient, SessionManager, MessageQueue, IncomingQueue, MessageHandler)
   - Integration —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ flow (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞)
   - Mock WhatsApp –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π whatsapp-web.js)
   - –¢–µ—Å—Ç—ã –¥–ª—è —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –Ω—É–∂–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ)
   - –¢–µ—Å—Ç—ã –¥–ª—è rate limiting –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤

6. **Best Practices –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** (–æ–±–Ω–æ–≤–ª–µ–Ω–æ):
   - ‚úÖ **–î–≤–µ –æ—á–µ—Ä–µ–¥–∏**: –û—Ç–¥–µ–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö
   - ‚úÖ **Rate limiting**: –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
   - ‚úÖ **–°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏**: –ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (2-10 —Å–µ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º)
   - ‚úÖ **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω (–Ω–µ 20)
   - ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∂–∞–ª–æ–± –∏ –Ω–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (post-MVP)
   - ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–Ω–∏–∂–∞—é—Ç —Ä–∏—Å–∫ –∂–∞–ª–æ–± (post-MVP)
   - ‚úÖ **–°–æ–≥–ª–∞—Å–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–∏—è –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–æ–π (post-MVP)
   - ‚ö†Ô∏è **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏–∑ best practices**:
     - **–î–ª—è –Ω–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤**: –ù–µ –±–æ–ª–µ–µ 20-30 —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å, –Ω–µ –±–æ–ª–µ–µ 5/—á–∞—Å (—É –Ω–∞—Å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–µ–µ: 10/–º–∏–Ω, 100/—á–∞—Å, 500/–¥–µ–Ω—å)
     - **–î–ª—è —Å—Ç–∞—Ä—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (>3 –º–µ—Å)**: –î–æ 100-200 —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å, –¥–æ 20/—á–∞—Å (–Ω–∞—à–∏ –ª–∏–º–∏—Ç—ã –ø–æ–¥—Ö–æ–¥—è—Ç)
     - **–£—Ä–æ–≤–µ–Ω—å –∂–∞–ª–æ–±**: –ù–µ –≤—ã—à–µ 0.1% (–æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤ post-MVP)
     - **–ù–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ù–µ –±–æ–ª–µ–µ 2% (–æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤ post-MVP)
     - **–ü—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π**: –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏, —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö

7. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è —É—á–µ—Ç–∞**:
   - ‚ö†Ô∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–≤—É—Ö –æ—á–µ—Ä–µ–¥–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices**:
     - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Ç–æ–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
     - ‚úÖ Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—á–µ—Ä–µ–¥–∏ (BullMQ limiter) + Redis —Å—á–µ—Ç—á–∏–∫–∏ (–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞)
     - ‚úÖ –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
     - ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Ä–∞–∑–Ω—ã–µ rate limiters –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π)
   - ‚ö†Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**:
     - –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ **—Å–æ–±—ã—Ç–∏—è** (–Ω–µ API –∑–∞–ø—Ä–æ—Å—ã), –Ω–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–ª–∞–µ–º **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã**
     - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã (`getContactById`, `getProfilePicUrl`, `getChatById`) –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–º rate limiter (5/–º–∏–Ω)
     - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ WhatsApp API
   - ‚ö†Ô∏è **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è**:
     - –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π (2-5 —Å–µ–∫) - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
     - –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º (2-10 —Å–µ–∫) - –∏–º–∏—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ "—Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ"
     - –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É API –∑–∞–ø—Ä–æ—Å–∞–º–∏ (0.5-2 —Å–µ–∫) - –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –±–æ—Ç–∞
   - ‚ö†Ô∏è **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏** (post-MVP):
     - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∂–∞–ª–æ–± (–Ω–µ –≤—ã—à–µ 0.1%)
     - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ –±–æ–ª–µ–µ 2%)
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–æ–∫ –ø—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
   - ‚ö†Ô∏è **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π** (post-MVP):
     - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–Ω–∏–∂–∞—é—Ç —Ä–∏—Å–∫ –∂–∞–ª–æ–±
     - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
   - ‚ö†Ô∏è **–°–æ–≥–ª–∞—Å–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (post-MVP):
     - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–∏—è –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–æ–π
     - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø–∏—Å–∫–∏

## üìù –õ–æ–≥ —Ä–∞–±–æ—Ç—ã

### 2025-12-23
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∑–∞–¥–∞—á–∞ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ WhatsApp Web
- ‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è `data-import`
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
- ‚úÖ **–®–∞–≥ 0.0**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π WhatsApp –≤ –ë–î –¥–ª—è Production
  - ‚úÖ –°–æ–∑–¥–∞–Ω `DatabaseAuth` –∫–ª–∞—Å—Å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º `DatabaseStore`
  - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Dockerfile –¥–ª—è Chromium
  - ‚úÖ –°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î
  - ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –°–æ–∑–¥–∞–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å —á–µ–∫-–ª–∏—Å—Ç–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å Prisma –∏–º–µ–Ω–∞–º–∏ –º–æ–¥–µ–ª–µ–π
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã enum –∑–Ω–∞—á–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ enum –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫)
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏–π (PENDING –≤–º–µ—Å—Ç–æ RECEIVED)
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –∏–∑ data-import
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–º–µ—á–∞–Ω–∏—è –æ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞—Ö –∏ rate limiting
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞:
  - ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –í—ã–Ω–µ—Å–µ–Ω—ã –≤ `Organization.settings.whatsapp` —Å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - ‚úÖ **–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞**: –î–æ–±–∞–≤–ª–µ–Ω endpoint –∏ UI –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —Å–ø–∞–º–∞
  - ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏**: –î–æ–±–∞–≤–ª–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π API (`sendMessageForAgent`, `sendBulkMessagesForAgent`)
  - ‚úÖ **–ò–º–ø–æ—Ä—Ç –∏–∑ UI**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∏–∑–±–µ–∂–∞–Ω–∏–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π
  - ‚úÖ **–≠—Ç–∞–ø 0**: –î–æ–±–∞–≤–ª–µ–Ω —ç—Ç–∞–ø –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç–∏–ø–æ–≤ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ WhatsApp
  - ‚úÖ **–≠—Ç–∞–ø 6**: –î–æ–±–∞–≤–ª–µ–Ω —ç—Ç–∞–ø –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞ —Å UI
  - ‚úÖ **–£—Ç–∏–ª–∏—Ç—ã**: –î–æ–±–∞–≤–ª–µ–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤
  - ‚úÖ **API endpoints**: –î–æ–±–∞–≤–ª–µ–Ω—ã endpoints –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –¥–≤—É–º—è –æ—á–µ—Ä–µ–¥—è–º–∏ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö):
  - ‚úÖ **–û—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏** (`whatsapp-send`): Rate limiting –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  - ‚úÖ **–û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö** (`whatsapp-incoming-process`): Rate limiting –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
  - ‚úÖ **–°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏**: –î–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (2-5 —Å–µ–∫ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π, 2-10 —Å–µ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º)
  - ‚úÖ **Rate limiting API**: –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ (getContactById, getProfilePicUrl) - –º–∞–∫—Å–∏–º—É–º 5/–º–∏–Ω—É—Ç—É
  - ‚úÖ **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**: –ò–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏
- ‚úÖ **–®–∞–≥ 0.0**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π WhatsApp –≤ –ë–î –¥–ª—è Production
  - ‚úÖ –°–æ–∑–¥–∞–Ω `DatabaseAuth` –∫–ª–∞—Å—Å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º `DatabaseStore`
  - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Dockerfile –¥–ª—è Chromium
  - ‚úÖ –°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î
  - ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
  - ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
    - ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: —Ä–∞–∑ –≤ —á–∞—Å (–≤–º–µ—Å—Ç–æ 5 –º–∏–Ω—É—Ç) - —ç–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ 12 —Ä–∞–∑
    - ‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –®–∞–≥ 2.1)
    - ‚úÖ Graceful shutdown —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –®–∞–≥ 2.2)

---

**–°—Ç–∞—Ç—É—Å**: üü° –í —Ä–∞–±–æ—Ç–µ  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-12-23 (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–π: 1 —á–∞—Å + –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏)

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **–≠—Ç–∞–ø 0**: –¢–∏–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 1**: Shared —É—Ç–∏–ª–∏—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 2**: WhatsApp Client —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ Session Manager - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 3**: –û—á–µ—Ä–µ–¥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ Handler - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 3.1.5**: –û—á–µ—Ä–µ–¥—å –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—á–µ—Ä–µ–¥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 3.2**: Handler –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä—Å–µ—Ä—ã –∏–∑ data-import - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 3.3**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 4**: API endpoints —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 5**: Frontend —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ API - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–≠—Ç–∞–ø 6**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Ü–µ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚úÖ **SessionManager ‚Üí IncomingQueue**: –ß–µ—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–æ —á–µ—Ä–µ–∑ `setIncomingQueue()`
- ‚úÖ **IncomingQueue ‚Üí SessionManager**: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è WhatsApp –∫–ª–∏–µ–Ω—Ç–∞ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **IncomingQueue ‚Üí SendQueue**: –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **IncomingQueue ‚Üí MessageHandler**: –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **MessageHandler ‚Üí data-import**: –î–ª—è –ø–∞—Ä—Å–µ—Ä–æ–≤ –∏ –∏–º–ø–æ—Ä—Ç–µ—Ä–æ–≤ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **SendQueue ‚Üí SessionManager**: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π**: –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ `IncomingQueue.processIncoming`, –∑–∞—Ç–µ–º Handler —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–≤—è–∑–∏ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤**: –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ `IncomingQueue` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, Handler –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤**: –†–∞–∑–≥–æ–≤–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ `IncomingQueue`, Handler –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π - –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è enum
- ‚úÖ **MessageSender**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MessageSender.HUMAN`, `MessageSender.AI`, `MessageSender.CLIENT` (–Ω–µ —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **MessageDirection**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MessageDirection.INCOMING`, `MessageDirection.OUTGOING` (–Ω–µ —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **MessageStatus**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MessageStatus.PENDING`, `MessageStatus.SENT`, `MessageStatus.DELIVERED`, `MessageStatus.FAILED` (–Ω–µ —Å—Ç—Ä–æ–∫–∏, –Ω–µ—Ç RECEIVED)
- ‚úÖ **WhatsAppSessionStatus**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `WhatsAppSessionStatus.CONNECTED`, `WhatsAppSessionStatus.DISCONNECTED`, `WhatsAppSessionStatus.QR_CODE_PENDING`, `WhatsAppSessionStatus.ERROR` (–Ω–µ —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **ClientStatus**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ClientStatus.NEW_LEAD` (–Ω–µ —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **CommunicationChannel**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `CommunicationChannel.WHATSAPP` (–Ω–µ —Å—Ç—Ä–æ–∫–∏)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤
- ‚úÖ **Prisma –∏–º–µ–Ω–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `prisma.whatsAppSession` (camelCase, –Ω–µ PascalCase)
- ‚úÖ **Redis**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Redis –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã
- ‚úÖ **Rate Limiting**: –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (BullMQ limiter + Redis —Å—á–µ—Ç—á–∏–∫–∏)
- ‚úÖ **–°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏**: –û–ø–∏—Å–∞–Ω—ã –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- ‚úÖ **–î–≤–µ –æ—á–µ—Ä–µ–¥–∏**: –û—Ç–¥–µ–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö
- ‚úÖ **–†–∞–∑–Ω—ã–µ —Å–µ—Å—Å–∏–∏**: –ò–º–ø–æ—Ä—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ `clientId` –∏ `dataPath`
- ‚úÖ **–≠–∫—Å–ø–æ—Ä—Ç—ã**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –∏–∑ `data-import`
- ‚úÖ **–¢–∏–ø—ã**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤ `ParsedClientData`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã —á–µ–∫-–ª–∏—Å—Ç–æ–≤
- ‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã –∏–º–µ—é—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ —á–µ–∫-–ª–∏—Å—Ç—ã
- ‚úÖ –í—Å–µ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ (‚ö†Ô∏è)
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–∏—Å–∞–Ω—ã –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –æ–ø–∏—Å–∞–Ω—ã

### –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞
‚úÖ **–ó–∞–¥–∞—á–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**
- –õ–æ–≥–∏–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ç–∫–æ –æ–ø–∏—Å–∞–Ω—ã
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π
- –í—Å–µ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã —É—á—Ç–µ–Ω—ã
- –ß–µ–∫-–ª–∏—Å—Ç—ã –ø–æ–ª–Ω—ã–µ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ
