# Статус базы данных

> **Дата настройки**: 2025-12-21  
> **Последнее обновление**: 2025-12-22  
> **Статус**: ✅ Настроена и готова к работе

## Информация о подключении

- **Хост**: localhost
- **Порт**: 5432
- **База данных**: soul_kg_crm
- **Пользователь**: Igor (текущий пользователь системы)
- **Схема**: public

## Созданные таблицы

Все таблицы успешно созданы через Prisma миграции:

1. ✅ `organizations` - Организации (мультитенантность)
2. ✅ `users` - Пользователи системы
3. ✅ `clients` - Клиенты
4. ✅ `client_status_history` - История изменения статусов клиентов
5. ✅ `conversations` - Разговоры с клиентами
6. ✅ `messages` - Сообщения в разговорах
7. ✅ `products` - Продукты (шаблоны туров)
8. ✅ `tours` - Конкретные туры с датами
9. ✅ `client_tours` - Связь клиентов с турами
10. ✅ `client_products` - Связь клиентов с продуктами
11. ✅ `partners` - Партнеры
12. ✅ `agent_configurations` - Конфигурации AI агентов
13. ✅ `prompt_variants` - Варианты промптов для A/B тестирования
14. ✅ `experiments` - Эксперименты A/B тестирования
15. ✅ `dialogue_analysis` - Анализ диалогов
16. ✅ `whatsapp_sessions` - Сессии WhatsApp

**Всего**: 17 таблиц (включая `_prisma_migrations`)

## Миграции

- ✅ `20251221071820_init` - Начальная миграция со всей схемой
- ✅ `20251221074210_add_status_detection_agent_type` - Добавлен тип агента для детекции статусов

## Проверка подключения

```bash
cd packages/database
export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"
psql soul_kg_crm -c "\dt"
```

## Полезные команды

```bash
# Открыть Prisma Studio (GUI для БД)
cd packages/database
npm run db:studio

# Создать новую миграцию
npm run db:migrate

# Сгенерировать Prisma Client после изменений схемы
npm run db:generate

# Подключиться к БД через psql
export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"
psql soul_kg_crm
```

## Следующие шаги

1. ✅ База данных настроена
2. ✅ Unit тесты для модуля импорта написаны
3. ⏭️ Интеграционное тестирование импорта данных из WhatsApp
4. ⏭️ Протестировать импорт на реальных данных (~100 переписок)
5. ⏭️ Создать seed данные для разработки (можно использовать результаты импорта)

